category: Network Security
commonfields:
  id: PANW IoT 3rd Party Integration - Tanium
  version: -1
configuration:
- additionalinfo: Tanium domain url to access it from integration
  display: Domain URL
  name: domain_url
  required: true
  type: 0
- display: Username
  name: credentials
  required: true
  type: 9
contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: ""
    itemVersion: ""
    packID: ""
    packName: ""
    prevname: ""
    propagationLabels:
    - all
    toServerVersion: ""
description: Tanium offers real-time visibility and control over endpoints such as
  desktops, laptops, servers, and mobile devices. This platform is designed to help
  organizations manage and secure their IT environments, detect and respond to security
  threats, and ensure compliance with industry regulations.
detaileddescription: |-
  ## Tanium Integration

  Please configure the instance by providing following mandatory details:

  - Name of the instance
   - Domain base URL
   - Username
   - Password

  To create user on on-prem server and on-cloud server. Please refer to this official Tanium documentation.
  [View documentation](https://docs.tanium.com/platform_user/platform_user/console_users.html#Create)

  ## Test Configuration

  After providing the mandatory details, please test the configuration using the Test button.

  ---
display: PANW IoT 3rd Party Integration - Tanium
image: data:image/png;base64,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
name: PANW IoT 3rd Party Integration - Tanium
script:
  commands:
  - arguments: []
    description: Get access token
    name: get-access-token
  - arguments:
    - description: Access token data
      name: token_data
      type: unknown
    description: Fetch access token command checks whether stored token is expired
      or not, if yes then renew it otherwise return as it is.
    name: fetch-access-token
  - arguments:
    - description: GraphQL query to fetch vulnerability data.
      name: query
    - name: access_token
    description: Get tanium endpoints along with thier vulnerabilties.
    name: get-tanium-vulnerabilties
  dockerimage: demisto/panw-iot:1.0.0.79918
  runonce: false
  script: |
    register_module_line('PANW IoT 3rd Party Integration - Tanium', 'start', __line__())


    import requests
    import json


    class TaniumRestAPI:
        """
        Class to use Tanium API
        """

        def __init__(self):
            self.taniumDomainUrl = self.checkTaniumHost()
            self.username = demisto.params().get("credentials", {}).get("identifier")
            self.password = demisto.params().get("credentials", {}).get("password")
            self.session = self.getSession()

        def checkTaniumHost(self):
            """
            Function will check whether hostname/ip-address is valid or not.
            """
            taniumDomainUrl = demisto.params().get("domain_url")
            try:
                if not taniumDomainUrl.startswith("https://"):
                    taniumDomainUrl = "https://" + taniumDomainUrl
                if taniumDomainUrl.startswith("http://"):
                    taniumDomainUrl = None
                    demisto.error("http:// is not valid for API access method, expected https")
            except Exception as ex:
                demisto.error("Error while validating Tanium Domain url" + str(ex))
            return taniumDomainUrl

        def getSession(self):
            """
            This function returns session
            """
            session = ""
            try:
                url = f"{self.taniumDomainUrl}/api/v2/session/login"


                payload = {"username": self.username, "password": self.password}
                headers = {"Content-Type": "application/json", "Accept": "application/json"}

                response = requests.request("POST", url, json=payload, headers=headers, verify=False)
                if response.status_code == 200:
                    session = response.json().get("data", {}).get("session", "")
                else:
                    session = response.json()
            except Exception as e:
                demisto.error("Error while getting session details " + str(e))
            return session

        def validateToken(self, accessToken):
            """
            Example function of how to validate that an API token is able
            to hit the Tanium server and get a 200 response.

            parameter ts is the Tanium server to use.
            Example: 'https://MyTaniumServer.com'
            parameter token is the api token string generated from the ts gui.
            """
            statusCode = ""
            token = accessToken
            try:
                if token:
                    resp = requests.post(
                        f"{self.taniumDomainUrl}/api/v2/session/validate",
                        json={"session": token},
                        headers={"session": token},
                        verify=False,
                    )
                    statusCode = resp.statusCode
            except Exception as e:
                demisto.error("Error while validating token " + str(e))
            return statusCode

        def getAccessToken(self):
            """
            This function returns accessToken.
            """
            tokenDict = {}
            try:
                resp = ""
                tokenUrl = f"{self.taniumDomainUrl}/api/v2/api_tokens"
                resp = requests.post(tokenUrl, json={"session": self.session}, headers={"session": self.session}, verify=False)
                if resp.status_code == 200:
                    tokenData = resp.json().get("data", None)
                    if tokenData:
                        tokenDict["token_id"] = tokenData.get("id", None)
                        tokenDict["token_user"] = tokenData.get("user", {}).get("name", None)
                        tokenDict["access_token"] = tokenData.get("token_string", None)
                        tokenDict["expire_in_days"] = tokenData.get("expire_in_days", None)
                        tokenDict["created_time"] = tokenData.get("created_time", None)
                        tokenDict["expiration_time"] = tokenData.get("expiration", None)
                else:
                    tokenDict = resp.json()
            except Exception as e:
                demisto.error("Error while getting accessToken " + str(e))
            return tokenDict

        def fetchAccessToken(self):
            """
            This function fetch accessToken and refresh_token
            """
            tokenData = demisto.args().get("token_data", "")
            try:
                if "access_token" in tokenData:
                    tokenData = json.loads(tokenData)
                    accessToken = tokenData.get("access_token", "")
                    validateToken = self.validateToken(accessToken)
                    if validateToken != 200:
                        # If token validation gets fail then we will get new access token
                        tokenData = self.getAccessToken()
            except Exception as e:
                demisto.error("Error while fetching accessToken" + str(e))
            return tokenData

        def getVulnerabilties(self):
            resp = {}
            queryString = demisto.args().get("query", "")
            accessToken = demisto.args().get("access_token", "")
            try:
                tokenUrl = f"{self.taniumDomainUrl}/plugin/products/gateway/graphql"
                response = requests.post(tokenUrl, json={"query": queryString}, headers={"session": accessToken}, verify=False)
                resp = response.json()
            except Exception as e:
                demisto.error("Error while getting vulnerabilties " + str(e))
            return resp


    def main():
        demisto.debug(f"Command being called is {demisto.command()}")
        test_res = ""
        try:
            if demisto.command() == "test-module":
                test_res = ""
                try:
                    api_login = TaniumRestAPI()
                    test_res = api_login.getSession()
                    if test_res:
                        if isinstance(test_res, str):
                            return_results('ok')
                        else:
                            return_results('Incorrect credentials provided, please check the config')
                    else:
                        return_results("Domain url is incorrect")
                except Exception as e:
                    return_error("Tanium got exception: %s" % str(e))

            if demisto.command() == "get-access-token":
                try:
                    api_login = TaniumRestAPI()
                    return_results(api_login.getAccessToken())
                except Exception as e:
                    return_error("get-access-token command got exception: %s" % str(e))

            if demisto.command() == "fetch-access-token":
                try:
                    api_login = TaniumRestAPI()
                    return_results(api_login.fetchAccessToken())
                except Exception as e:
                    return_error("fetch-access-token command got exception: %s" % str(e))

            if demisto.command() == "get-tanium-vulnerabilties":
                try:
                    api_login = TaniumRestAPI()
                    return_results(api_login.getVulnerabilties())
                except Exception as e:
                    return_error("get-tanium-vulnerabilties command got exception: %s" % str(e))
        except Exception as e:
            return_error(f"Failed to execute {demisto.command()} command.\nError:\n{str(e)}")


    if __name__ in ("__main__", "__builtin__", "builtins"):
        main()

    register_module_line('PANW IoT 3rd Party Integration - Tanium', 'end', __line__())
  subtype: python3
  type: python
sourcemoduleid: PANW IoT 3rd Party Integration - Tanium
