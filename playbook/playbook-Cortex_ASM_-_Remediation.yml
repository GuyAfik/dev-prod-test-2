contentitemexportablefields:
  contentitemfields:
    definitionid: ""
    fromServerVersion: 6.10.0
    itemVersion: 1.7.65
    packID: CortexAttackSurfaceManagement
    packName: Cortex Attack Surface Management
    packPropagationLabels:
    - all
    prevname: ""
    propagationLabels: []
    toServerVersion: ""
description: This playbook contains all the cloud provider sub playbooks for remediation.
id: Cortex ASM - Remediation
inputs:
- description: If assuming roles for AWS, this is the name of the role to assume (should
    be the same for all organizations)
  key: AWSAssumeRoleName
  playbookInputQuery: null
  required: false
  value: {}
name: Cortex ASM - Remediation
outputs: []
starttaskid: "0"
system: true
tasks:
  "0":
    continueonerrortype: ""
    id: "0"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#none#':
      - "3"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: 41328bf8-d0ab-4322-8df0-3ef3a6f7911b
      iscommand: false
      name: ""
      version: -1
    taskid: 41328bf8-d0ab-4322-8df0-3ef3a6f7911b
    timertriggers: []
    type: start
    view: |-
      {
        "position": {
          "x": 510,
          "y": 20
        }
      }
  "3":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: provider
                root: alert.asmcloud
          operator: containsGeneral
          right:
            value:
              simple: AWS
      label: AWS
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: provider
                root: alert.asmcloud
          operator: containsGeneral
          right:
            value:
              simple: GCP
      label: GCP
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: provider
                root: alert.asmcloud
          operator: containsGeneral
          right:
            value:
              simple: Azure
      label: Azure
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: asmattacksurfaceruleid
                root: alert
                transformers:
                - args:
                    chars:
                      value:
                        simple: '[\"]'
                  operator: StripChars
          operator: isEqualString
          right:
            value:
              simple: UnclaimedS3Bucket
      label: Unclaimed S3 Bucket
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: provider
                root: alert.asmcloud
          operator: containsGeneral
          right:
            value:
              simple: On Prem
      label: On Prem
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.asmsystemids.type
                    operator: isEqualString
                    right:
                      value:
                        simple: CORTEX-ENDPOINT-ASSET-ID
                root: alert.asmsystemids
          operator: isNotEmpty
      label: Cortex Endpoint
    continueonerrortype: ""
    id: "3"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "4"
      AWS:
      - "15"
      Azure:
      - "6"
      Cortex Endpoint:
      - "13"
      GCP:
      - "9"
      On Prem:
      - "12"
      Unclaimed S3 Bucket:
      - "7"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines which cloud provider the service is in order to direct
        to the correct enrichment.
      id: 27c5352a-022a-4aff-87d4-8d948fa788bc
      iscommand: false
      name: What provider is this service?
      type: condition
      version: -1
    taskid: 27c5352a-022a-4aff-87d4-8d948fa788bc
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": 510,
          "y": 170
        }
      }
  "4":
    continueonerrortype: ""
    id: "4"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      id: f8177daa-c79e-4080-8d8a-40ea707367aa
      iscommand: false
      name: Completed
      type: title
      version: -1
    taskid: f8177daa-c79e-4080-8d8a-40ea707367aa
    timertriggers: []
    type: title
    view: |-
      {
        "position": {
          "x": 520,
          "y": 1360
        }
      }
  "6":
    continueonerrortype: ""
    id: "6"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      AzureSecurityGroup:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-SG
          root: alert.asmsystemids
      AzureVMPrivateIP:
        complex:
          accessor: ip
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmprivateip.source
              operator: isEqualString
              right:
                value:
                  simple: Azure
          root: alert.asmprivateip
      RemediationAllowRanges:
        simple: 172.16.0.0/12,10.0.0.0/8,192.168.0.0/16
      RemotePort:
        complex:
          accessor: remoteport
          root: alert
      RemoteProtocol:
        complex:
          accessor: asmprotocol
          root: alert
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: |-
        This playbook adds new Azure Network Security Groups (NSG) rules to NSGs attached to a NIC. The new rules will give access only to a private IP address range and block traffic that's exposed to the public internet ([using the private IP of the VM as stated in Azure documentation](https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview)). For example, if RDP is exposed to the public internet, this playbook adds new firewall rules that only allow traffic from private IP addresses and blocks the rest of the RDP traffic.

        Conditions and limitations:
        - Limited to one resource group.
        - 200 Azure rules viewed at once to find offending rule.
        - 2 priorities lower than the offending rule priority must be available.
        - Adds rules to NSGs associated to NICs.
      id: 57d9147d-2a07-41d4-8cc9-f54a8950643f
      iscommand: false
      name: Azure - Network Security Group Remediation
      playbookId: Azure - Network Security Group Remediation
      type: playbook
      version: -1
    taskid: 57d9147d-2a07-41d4-8cc9-f54a8950643f
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1220,
          "y": 610
        }
      }
  "7":
    continueonerrortype: ""
    id: "7"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      S3BucketName:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: S3-BucketName
          root: alert.asmsystemids
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: The playbook will create the unclaimed S3 bucket.
      id: c03179f9-4132-4a54-8f0f-4a63d31a6f40
      iscommand: false
      name: AWS - Unclaimed S3 Bucket Remediation
      playbookId: AWS - Unclaimed S3 Bucket Remediation
      type: playbook
      version: -1
    taskid: c03179f9-4132-4a54-8f0f-4a63d31a6f40
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -110,
          "y": 635
        }
      }
  "8":
    continueonerrortype: ""
    id: "8"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      InstanceID:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ID
          root: alert.asmsystemids
      Port:
        complex:
          accessor: remoteport
          root: alert
      Protocol:
        complex:
          accessor: asmprotocol
          root: alert
          transformers:
          - operator: toLowerCase
      PublicIP:
        complex:
          accessor: remoteip
          root: alert
      Region:
        complex:
          accessor: region
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook takes in some information about an EC2 instance (ID
        and public_ip) and with provided port and protocol, determines what security
        groups on the primary interface of an EC2 instance are over-permissive. It
        uses an automation to determine what interface on an EC2 instance has an over-permissive
        security group on, determine which security groups have over-permissive rules
        and to replace them with a copy of the security group that has only the over-permissive
        portion removed.  Over-permissive is defined as sensitive ports (SSH, RDP,
        etc) being exposed to the internet via IPv4.
      id: 0d8eb068-70f3-4fe0-80ef-ca218e2cd125
      iscommand: false
      name: AWS - Security Group Remediation v2
      playbookId: AWS - Security Group Remediation v2
      type: playbook
      version: -1
    taskid: 0d8eb068-70f3-4fe0-80ef-ca218e2cd125
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -420,
          "y": 1160
        }
      }
  "9":
    continueonerrortype: ""
    id: "9"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      GcpInstance:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-NAME
          root: alert.asmsystemids
      GcpNetwork:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-VIRTUAL-NET
          root: alert.asmsystemids
      GcpProject:
        complex:
          accessor: project
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
      GcpZone:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ZONE
          root: alert.asmsystemids
      RemotePort:
        complex:
          accessor: remoteport
          root: alert
      RemoteProtocol:
        complex:
          accessor: asmprotocol
          root: alert
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      id: 3008b5df-87a9-407c-894b-e346377b1145
      iscommand: false
      name: GCP - Firewall Remediation
      playbookId: GCP - Firewall Remediation
      type: playbook
      version: -1
    taskid: 3008b5df-87a9-407c-894b-e346377b1145
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 790,
          "y": 730
        }
      }
  "10":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                root: inputs.AWSAssumeRoleName
          operator: isNotEmpty
      label: "yes"
    continueonerrortype: ""
    id: "10"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "8"
      "yes":
      - "11"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Determines which cloud provider the service is in order to direct
        to the correct enrichment.
      id: 231659ad-e527-4ca9-806c-e9392b78dabb
      iscommand: false
      name: Is AWSAssumeRoleName Input defined?
      type: condition
      version: -1
    taskid: 231659ad-e527-4ca9-806c-e9392b78dabb
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -600,
          "y": 760
        }
      }
  "11":
    continueonerrortype: ""
    id: "11"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      AWSAssumeArn:
        complex:
          accessor: project
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
          - args:
              prefix:
                value:
                  simple: 'arn:aws:iam::'
              suffix:
                value:
                  simple: :role/
            operator: concat
          - args:
              prefix: {}
              suffix:
                iscontext: true
                value:
                  simple: inputs.AWSAssumeRoleName
            operator: concat
      InstanceID:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ID
          root: alert.asmsystemids
      Port:
        complex:
          accessor: remoteport
          root: alert
      Protocol:
        complex:
          accessor: asmprotocol
          root: alert
          transformers:
          - operator: toLowerCase
      PublicIP:
        complex:
          accessor: remoteip
          root: alert
      Region:
        complex:
          accessor: region
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook takes in some information about an EC2 instance (ID
        and public_ip) and with provided port and protocol, determines what security
        groups on the primary interface of an EC2 instance are over-permissive.  It
        uses an automation to determine what interface on an EC2 instance has an over-permissive
        security group on, determine which security groups have over-permissive rules
        and to replace them with a copy of the security group that has only the over-permissive
        portion removed.  Over-permissive is defined as sensitive ports (SSH, RDP,
        etc) being exposed to the internet via IPv4.
      id: 438b1fed-2bbe-4214-8883-bcfd8f9e2000
      iscommand: false
      name: AWS - Security Group Remediation v2
      playbookId: AWS - Security Group Remediation v2
      type: playbook
      version: -1
    taskid: 438b1fed-2bbe-4214-8883-bcfd8f9e2000
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -810,
          "y": 1000
        }
      }
  "12":
    continueonerrortype: ""
    id: "12"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      DeviceGroup:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: FIREWALL-DEVICE-GROUP
          root: alert.asmsystemids
      RemoteIP:
        complex:
          accessor: remoteip
          root: alert
      RemotePort:
        complex:
          accessor: remoteport
          root: alert
      RemoteProtocol:
        complex:
          accessor: asmprotocol
          root: alert
          transformers:
          - operator: toLowerCase
      RuleName:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: FIREWALL-RULE-NAME
          root: alert.asmsystemids
      SecondaryDeviceGroup:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: FIREWALL-SECONDARY-DEVICE-GROUP
          root: alert.asmsystemids
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      description: |-
        This playbook adds new block rule(s) to on-prem firewall vendors in order to block internet access for internet exposures.

        Conditions:
        This is currently limited to stand-alone firewalls for PAN-OS.
      id: c8e87bd8-3019-42db-8ac9-2e8193077cc6
      iscommand: false
      name: Cortex ASM - On Prem Remediation
      playbookId: Cortex ASM - On Prem Remediation
      type: playbook
      version: -1
    taskid: c8e87bd8-3019-42db-8ac9-2e8193077cc6
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 1650,
          "y": 480
        }
      }
  "13":
    continueonerrortype: ""
    id: "13"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 0
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      CortexEndpointID:
        complex:
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: CORTEX-ENDPOINT-ASSET-ID
          root: alert.asmsystemids
          transformers:
          - args:
              field:
                value:
                  simple: id
            operator: getField
    separatecontext: true
    skipunavailable: false
    task:
      brand: ""
      id: 9597ebaa-a391-45d6-8b94-367e5f110b7f
      iscommand: false
      name: Cortex ASM - Cortex Endpoint Remediation
      playbookId: Cortex ASM - Cortex Endpoint Remediation
      type: playbook
      version: -1
    taskid: 9597ebaa-a391-45d6-8b94-367e5f110b7f
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": 250,
          "y": 1050
        }
      }
  "14":
    continueonerrortype: ""
    id: "14"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    loop:
      exitCondition: ""
      iscommand: false
      max: 100
      wait: 1
    nexttasks:
      '#none#':
      - "4"
    note: false
    quietmode: 0
    scriptarguments:
      ASM Rule ID:
        simple: ${alert.asmattacksurfaceruleid}
      Account ID:
        simple: ${alert.asmcloud.project}
      Assume Role:
        simple: ${inputs.AWSAssumeRoleName}
      Instance ID:
        complex:
          accessor: id
          filters:
          - - left:
                iscontext: true
                value:
                  simple: alert.asmsystemids.type
              operator: isEqualString
              right:
                value:
                  simple: ASSET-ID
          root: alert.asmsystemids
      Region:
        complex:
          accessor: region
          root: alert.asmcloud
          transformers:
          - operator: FirstArrayElement
    separatecontext: true
    skipunavailable: true
    task:
      brand: ""
      description: This playbook upgrades supported packages on an AWS EC2 instance
        using AWS Systems manager.
      id: d22ca941-9360-417f-8d13-c86eae687622
      iscommand: false
      name: AWS - Package Upgrade
      playbookId: AWS - Package Upgrade
      type: playbook
      version: -1
    taskid: d22ca941-9360-417f-8d13-c86eae687622
    timertriggers: []
    type: playbook
    view: |-
      {
        "position": {
          "x": -1250,
          "y": 785
        }
      }
  "15":
    conditions:
    - condition:
      - - left:
            iscontext: true
            value:
              complex:
                accessor: id
                filters:
                - - left:
                      iscontext: true
                      value:
                        simple: alert.asmsystemids.type
                    operator: isEqualString
                    right:
                      value:
                        simple: ASSET-SSM-PLATFORM-NAME
                root: alert.asmsystemids
          operator: isNotEmpty
          right:
            value: {}
      - - left:
            iscontext: true
            value:
              simple: alert.asmdatacollection.selected
          operator: isEqualString
          right:
            value:
              simple: Automated remediation by patching vulnerable software
      label: "yes"
    continueonerrortype: ""
    id: "15"
    ignoreworker: false
    isautoswitchedtoquietmode: false
    isoversize: false
    nexttasks:
      '#default#':
      - "10"
      "yes":
      - "14"
    note: false
    quietmode: 0
    separatecontext: false
    skipunavailable: false
    task:
      brand: ""
      description: Is AWS Systems manager option selected for remediation?
      id: 428b2bb0-e540-4d7e-8f02-044e35dbcd33
      iscommand: false
      name: Is AWS Systems manager option selected for remediation?
      type: condition
      version: -1
    taskid: 428b2bb0-e540-4d7e-8f02-044e35dbcd33
    timertriggers: []
    type: condition
    view: |-
      {
        "position": {
          "x": -830,
          "y": 450
        }
      }
version: -1
view: |-
  {
    "linkLabelsPosition": {},
    "paper": {
      "dimensions": {
        "height": 1405,
        "width": 3280,
        "x": -1250,
        "y": 20
      }
    }
  }
